<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administracion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-clock me-2"></i>Sistema de Turnos
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Alternar navegacion">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/templates/index.html">
                            <i class="fas fa-home me-1"></i>Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/templates/panel_admin.html">
                            <i class="fas fa-cog me-1"></i>Panel Admin
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/templates/logout.html">
                            <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesion
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-cog me-2"></i>Panel de Administracion</h2>
                    <div class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        <span id="reloj"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Turnos en Atencion -->
            <div class="col-lg-6 mb-4">
                <div class="card border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-play-circle me-2"></i>En Atencion
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted text-center py-3">No hay turnos en atencion</p>
                    </div>
                </div>
            </div>

            <!-- Turnos Esperando -->
            <div class="col-lg-6 mb-4">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-clock me-2"></i>En Espera
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted text-center py-3">No hay turnos en espera</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadisticas -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>Estadisticas del Dia
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                    <h4 id="total-turnos">0</h4>
                                    <p class="text-muted mb-0">Total Turnos</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                                    <h4 id="turnos-esperando">0</h4>
                                    <p class="text-muted mb-0">En Espera</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <i class="fas fa-play fa-2x text-success mb-2"></i>
                                    <h4 id="turnos-atendiendo">0</h4>
                                    <p class="text-muted mb-0">En Atencion</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <i class="fas fa-check fa-2x text-info mb-2"></i>
                                    <h4 id="turnos-completados">0</h4>
                                    <p class="text-muted mb-0">Completados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categorias -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>Categorias de Atencion
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Categoria</th>
                                        <th>Descripcion</th>
                                        <th>Tiempo Estimado</th>
                                        <th>Estado</th>
                                        <th>Turnos en Espera</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <strong>Atencion General</strong>
                                        </td>
                                        <td>Consultas generales</td>
                                        <td>15 min</td>
                                        <td>
                                            <span class="badge bg-success">Activa</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">0</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Pagos</strong>
                                        </td>
                                        <td>Realizar pagos</td>
                                        <td>10 min</td>
                                        <td>
                                            <span class="badge bg-success">Activa</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">0</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Reclamos</strong>
                                        </td>
                                        <td>Presentar reclamos</td>
                                        <td>20 min</td>
                                        <td>
                                            <span class="badge bg-success">Activa</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">0</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Informes</strong>
                                        </td>
                                        <td>Solicitar informes</td>
                                        <td>25 min</td>
                                        <td>
                                            <span class="badge bg-success">Activa</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">0</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">Copyright 2024 Sistema de Turnos. Desarrollado con Flask.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script>
    // Actualizar reloj
    function actualizarReloj() {
        const ahora = new Date();
        document.getElementById('reloj').textContent = ahora.toLocaleTimeString();
    }

    setInterval(actualizarReloj, 1000);
    actualizarReloj();

    // Funciones para gestionar turnos
    function iniciarTurno(turnoId) {
        fetch(`/iniciar_turno/${turnoId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            });
    }

    function completarTurno(turnoId) {
        fetch(`/completar_turno/${turnoId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            });
    }

    function cancelarTurno(turnoId) {
        if (confirm('Estas seguro de que quieres cancelar este turno?')) {
            fetch(`/cancelar_turno/${turnoId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                });
        }
    }

    // Actualizar estadisticas cada 30 segundos
    function actualizarEstadisticas() {
        fetch('/api/turnos_esperando')
            .then(response => response.json())
            .then(data => {
                document.getElementById('turnos-esperando').textContent = data.length;
            });
    }

    setInterval(actualizarEstadisticas, 30000);
    actualizarEstadisticas();
    </script>
</body>
</html>
